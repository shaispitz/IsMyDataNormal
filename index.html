<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1415713364521919"
     crossorigin="anonymous"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Is My Data Normal?</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-box-and-violin-plot/build/Chart.BoxPlot.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(to right, #f0f4f8, #d9e2ec);
    }
    .card {
      background: white;
      border-radius: 1rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      padding: 2rem;
    }
    .card h1 {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    input[type="file"]::-webkit-file-upload-button {
      background: #3b82f6;
      color: white;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 0.375rem;
      cursor: pointer;
      transition: background 0.3s;
    }
    input[type="file"]::-webkit-file-upload-button:hover {
      background: #2563eb;
    }
    button#resetButton {
      transition: all 0.3s;
    }
    button#resetButton:hover {
      background-color: #e5e7eb;
    }
  </style>
</head>
<body class="text-gray-800">
  
  <div class="max-w-2xl mx-auto mt-12 card">
    <h1 class="text-4xl font-extrabold mb-4 text-center text-blue-700">Is My Data Normal?</h1>
   <p><strong>KL Divergence</strong> (Kullback–Leibler Divergence) measures the difference between two probability density functions. In this case, we compare the empirical distribution of your data to a <em>normal distribution</em> with the same mean and standard deviation.</p>

<p>It tells us how much information is lost when the normal distribution is used to approximate your data. The smaller the KL divergence, the closer your data's shape is to a normal curve. A value of 0 means a perfect match.</p>

<p><strong>How to interpret the result:</strong></p>
<ul class="list-disc list-inside mt-3 text-sm">
  <li><strong>&lt; 0.1</strong>: Very close to normal — your data closely matches a Gaussian distribution</li>
  <li><strong>0.1 – 0.5</strong>: Reasonably normal — small but acceptable deviations</li>
  <li><strong>0.5 – 1.0</strong>: Noticeable deviation — the distribution shape differs in a meaningful way</li>
  <li><strong>&gt; 1.0</strong>: Strong deviation — your data is far from normal</li>
</ul>


    <p class="text-center text-lg text-gray-600 mb-6 mt-6">Upload a CSV file with a single column of numbers. We’ll compute the KL Divergence from a normal distribution.</p>
    <div class="flex justify-center">
      <input type="file" id="fileInput" accept=".csv" class="block w-full text-sm text-gray-700 border border-gray-300 rounded-md cursor-pointer" />
    </div>

    <h2 class="text-xl font-semibold mt-10 mb-2 text-gray-700">Results</h2>
    <div id="summary" class="mt-6 text-left text-sm whitespace-pre-line font-mono bg-gray-50 p-4 rounded"></div>
    <div id="result" class="mt-4 text-center text-lg font-semibold"></div>
    
    <div class="overflow-x-auto mt-6">
      <canvas id="histogram"></canvas>
    </div>

    <div class="overflow-x-auto mt-6">
      <canvas id="boxplot"></canvas>
    </div>

    <div class="text-center mt-6">
      <button id="resetButton" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded shadow-sm hover:shadow-md">Reset</button>
    </div>
  </div>

  <script>
    function parseCSV(text) {
      const lines = text.trim().split("\n");
      return lines.map(Number).filter(x => !isNaN(x));
    }

    function mean(arr) {
      return arr.reduce((a, b) => a + b, 0) / arr.length;
    }

    function std(arr, mu) {
      return Math.sqrt(arr.reduce((a, b) => a + (b - mu) ** 2, 0) / arr.length);
    }

    function normalPDF(x, mu, sigma) {
      const a = 1 / (sigma * Math.sqrt(2 * Math.PI));
      const b = Math.exp(-((x - mu) ** 2) / (2 * sigma ** 2));
      return a * b;
    }

    function computeHistogram(data, bins = 30) {
      const min = Math.min(...data);
      const max = Math.max(...data);
      const binWidth = (max - min) / bins;
      const counts = Array(bins).fill(0);
      const binCenters = [];

      data.forEach(x => {
        const i = Math.min(Math.floor((x - min) / binWidth), bins - 1);
        counts[i]++;
      });

      for (let i = 0; i < bins; i++) {
        binCenters.push(min + (i + 0.5) * binWidth);
      }

      return { counts, binCenters, binWidth, min, max };
    }

    function klDivergence(data, mu, sigma, binCenters, binWidth, counts) {
      const total = data.length;
      const p = counts.map(c => c / total);
      const q = binCenters.map(x => normalPDF(x, mu, sigma) * binWidth);

      let kl = 0;
      for (let i = 0; i < p.length; i++) {
        if (p[i] > 0 && q[i] > 0) {
          kl += p[i] * Math.log(p[i] / q[i]);
        }
      }
      return kl;
    }

    function percentile(arr, p) {
      if (arr.length === 0) return null;
      const sorted = [...arr].sort((a, b) => a - b);
      const index = (p / 100) * (sorted.length - 1);
      const lower = Math.floor(index);
      const upper = Math.ceil(index);
      if (lower === upper) return sorted[lower];
      return sorted[lower] + (sorted[upper] - sorted[lower]) * (index - lower);
    }

    let chart, boxChart;

    document.getElementById("fileInput").addEventListener("change", (event) => {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        const values = parseCSV(e.target.result);
        if (values.length < 2) {
          document.getElementById("result").textContent = "Not enough valid data.";
          return;
        }

        const mu = mean(values);
        const sigma = std(values, mu);
        const { counts, binCenters, binWidth } = computeHistogram(values);
        const total = values.length;
        const normalizedCounts = counts.map(c => c / total);
        const normalValues = binCenters.map(x => normalPDF(x, mu, sigma) * binWidth);
        const kl = klDivergence(values, mu, sigma, binCenters, binWidth, counts);

        const p10 = percentile(values, 10);
        const p25 = percentile(values, 25);
        const p50 = percentile(values, 50);
        const p75 = percentile(values, 75);
        const p90 = percentile(values, 90);

        const summaryText = `Samples: ${values.length}
Mean: ${mu.toFixed(4)}
Standard Deviation: ${sigma.toFixed(4)}
KL Divergence: ${kl.toFixed(4)}

Percentiles:
P10: ${p10.toFixed(4)}
P25: ${p25.toFixed(4)}
P50 (Median): ${p50.toFixed(4)}
P75: ${p75.toFixed(4)}
P90: ${p90.toFixed(4)}

First 10 values:
${values.slice(0, 10).map(v => v.toFixed(4)).join(", ")}`;
        document.getElementById("summary").textContent = summaryText;

        const ctx = document.getElementById("histogram").getContext("2d");
        if (chart) chart.destroy();
        chart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: binCenters.map(x => x.toFixed(2)),
            datasets: [
              {
                label: "Observed Frequency",
                data: normalizedCounts,
                backgroundColor: "rgba(54, 162, 235, 0.6)",
              },
              {
                type: "line",
                label: "Normal Distribution",
                data: normalValues,
                borderColor: "rgba(255, 99, 132, 1)",
                backgroundColor: "rgba(255, 99, 132, 0.1)",
                fill: false,
                tension: 0.2,
                pointRadius: 0
              }
            ]
          },
          options: {
            scales: {
              x: { title: { display: true, text: "Value" } },
              y: { title: { display: true, text: "Density" } }
            }
          }
        });

        const boxCtx = document.getElementById("boxplot").getContext("2d");
        if (boxChart) boxChart.destroy();
        boxChart = new Chart(boxCtx, {
          type: 'boxplot',
          data: {
            labels: ['Data'],
            datasets: [{
              label: 'Boxplot of Uploaded Data',
              backgroundColor: 'rgba(75, 192, 192, 0.4)',
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 1,
              outlierColor: '#999999',
              padding: 10,
              itemRadius: 0,
              data: [{
                min: Math.min(...values),
                max: Math.max(...values),
                q1: p25,
                median: p50,
                q3: p75
              }]
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: false },
              title: {
                display: true,
                text: 'Box Plot (P25–P75 Range)'
              }
            }
          }
        });
      };
      reader.readAsText(file);
    });

    document.getElementById("resetButton").addEventListener("click", () => {
      document.getElementById("fileInput").value = null;
      document.getElementById("result").textContent = "";
      document.getElementById("summary").textContent = "";
      if (chart) chart.destroy();
      if (boxChart) boxChart.destroy();
    });
  </script>
</body>
</html>
